TEST SCRIPT: TS-048
Test Scenario: Post Product Rating
User Story: As a Buyer who purchased a product, I want to rate a product with a star rating, so that I can share my satisfaction level with other shoppers
Priority: Medium
Related Requirements: FR-011

GIVEN the user is logged in as "emily.johnson@email.com"
  AND the user has previously ordered "Classic Cotton Shirt" in Order #1001
  AND Order #1001 status is "Delivered"
  AND the user has not yet rated this product

WHEN the user navigates to Order #1001 details
  AND clicks "Rate Product" or "Write Review" for "Classic Cotton Shirt"

THEN the system should verify the user purchased this product
  AND display the rating and review form showing:
    - Product name and image
    - Star rating selector (1-5 stars)
    - Review title field (optional)
    - Review text area (optional)

WHEN the user clicks on the 4-star rating
  AND clicks "Submit Rating"

THEN the system should validate the user purchased the product
  AND create a rating record with:
    - Product ID
    - User ID
    - Rating Value: 4
    - Status: "Pending"
    - Timestamp
  AND display confirmation: "Thank you for your rating. It will be published after review."
  AND send notification to admin for approval

WHEN an admin approves the rating

THEN the rating status should change to "Approved"
  AND the product's average rating should be recalculated
  AND the rating count should be incremented
  AND the rating should be visible on the product page

WHEN the user attempts to rate a product they haven't purchased

THEN the system should display a message: "You can only rate products you have purchased"
  AND not allow rating submission

WHEN the user attempts to rate the same product twice

THEN the system should display their existing rating
  AND allow them to update it
  AND display message: "Update your previous rating"

EXPECTED RESULT:
- Users can successfully rate purchased products
- Purchase verification is enforced
- Ratings require admin approval before publication
- Product average rating is correctly calculated
- Duplicate ratings are prevented
- Users can update their previous ratings
